#!/bin/sh
# postinst script for debtrack
#
# see: dh_installdeb(1)

set -e
. /usr/share/debconf/confmodule

CFG="/etc/debtrack.conf"

case "$1" in
    configure)
	# create user
	if ! getent passwd debtrack > /dev/null ; then
	  echo 'Adding system-user for debtrack' 1>&2
	  adduser --system --group --quiet --home /var/lib/debtrack \
	    --shell /bin/sh --no-create-home --disabled-login debtrack
	fi
	
	# fix owner
	chown -R debtrack:debtrack /var/lib/debtrack

	# configure
	db_get debtrack/download
	DOWNLOAD="$RET"

	db_get debtrack/mdst
	MDST="$RET"

	db_get debtrack/apt
	APTHOOK="$RET"


	mv "$CFG" "$CFG".dpkg-save
	cat "$CFG".dpkg-save | \
	    sed -e "s/^MDST=.*$/MDST=\"$MDST\"/" | \
	    sed -e "s/^DOWNLOAD=.*$/DOWNLOAD=\"$DOWNLOAD\"/" | \
	    sed -e "s/^APTHOOK=.*$/APTHOOK=\"$APTHOOK\"/" > \
	    "$CFG"
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
